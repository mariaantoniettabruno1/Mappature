function closestNumber(n, m, o) {
  for (var i = 1; i <= n; i++) {
    if (i % m == 0 && i >= o) {
      var a = i;
      return a;
    }
  }
}
jQuery(document).ready(function() {
  jQuery("body").on("click", ".jOrgChart .open-popup", function() {
    var get_element_id = jQuery(this).attr("href");
    // console.log(get_element_id);
    var find_near = jQuery(this)
      .closest(".show_children")
      .attr("id");

    var find_chart = jQuery(this)
      .parents(".orgChart")
      .attr("id");
    // console.log(find_chart);
    // console.log(find_near);
    if (jQuery(this).closest(".show_children").length) {
      jQuery.magnificPopup.open({
        items: {
          src: "#" + find_near + " " + get_element_id
        },
        type: "inline"
      });
    } else {
      jQuery.magnificPopup.open({
        items: {
          src: "#" + find_chart + " " + get_element_id
        },
        type: "inline"
      });
    }
  });

  /* Generate Chart */
  jQuery(".ocp_pro").each(function(index) {
    jQuery(this).jOrgChart({
      chartElement:
        ".chart_" +
        jQuery(this)
          .next()
          .data("chartid"),
      dragAndDrop: !1
    });
  });
});
var isMobile = {
  Android: function() {
    return navigator.userAgent.match(/Android/i);
  },
  BlackBerry: function() {
    return navigator.userAgent.match(/BlackBerry/i);
  },
  iOS: function() {
    return navigator.userAgent.match(/iPhone/i);
  },
  Opera: function() {
    return navigator.userAgent.match(/Opera Mini/i);
  },
  Windows: function() {
    return (
      navigator.userAgent.match(/IEMobile/i) ||
      navigator.userAgent.match(/WPDesktop/i)
    );
  },
  any: function() {
    return (
      isMobile.Android() ||
      isMobile.BlackBerry() ||
      isMobile.iOS() ||
      isMobile.Opera() ||
      isMobile.Windows()
    );
  }
};

if (isMobile.any()) {
  var disable_counter = 1;
  var main_counter = 1;
  jQuery(document).ready(function() {
    jQuery(".jOrgChart tr td.node-container").each(function() {
      jQuery(this)
        .find("td.node-container")
        .parent()
        .hide();
      jQuery(this)
        .find("td.node-container")
        .parent()
        .prevUntil("tr.node-cells")
        .hide();
      if (
        jQuery(this)
          .find("tr.node-cells")
          .next().length < 1
      ) {
      } else {
        if (
          jQuery(this)
            .find("tr.node-cells td")
            .find(".downarrow").length < 1
        ) {
          var down_class = jQuery(this)
            .find("tr.node-cells td")
            .find(".overlay1")
            .data("id");

          jQuery(this)
            .find("tr.node-cells td")
            .each(function() {
              jQuery(this).append(
                "<div class='downarrow fa fa-arrow-down' data-target='target" +
                  main_counter +
                  "'></div>"
              );
              main_counter++;
            });
        }
      }
      main_counter++;
    });
    jQuery("body").on("touchstart touch tap", "div.downarrow", function() {
      // Remove any open Children
      jQuery(this)
        .closest(".node-container")
        .siblings(".show_children")
        .remove();

      // if clicked on same parent
      if (jQuery(this).hasClass("active-child")) {
        jQuery(this).removeClass("active-child");
        jQuery(this)
          .addClass("fa-arrow-down")
          .removeClass("fa-arrow-up");
        return false;
      }

      // if any other parent is clicked

      jQuery(this)
        .closest(".org-row")
        .find("div.downarrow")
        .removeClass("active-child");

      //  change arrows
      jQuery(this)
        .closest(".org-row")
        .find("div.downarrow")
        .removeClass("fa-arrow-up")
        .addClass("fa-arrow-down");

      jQuery(this).addClass("active-child");
      jQuery(this).removeClass("fa-arrow-down");
      jQuery(this).addClass("fa-arrow-up");
      //  console.log("down click fired");
      var get_target = jQuery(this).data("target");
      // console.log(get_target);

      var index = jQuery(this)
        .closest(".node-container")
        .index();
      var ilength = jQuery(this)
        .closest("tr.org-row")
        .children(".node-container").length;
      // console.log("Index: " + index);
      var reminder = index % 4;
      var value = 4 - reminder;
      var target = value + index;
      //  console.log("Target: " + target);

      var content = jQuery(this)
        .closest(".node-cells")
        .siblings(".child_box")
        .html();
      //   console.log("Length: " + ilength);
      var node_class = "";
      var temp_node =
        '<td id= "' +
        get_target +
        '" class="node-container show_children ' +
        node_class +
        '"><table><tr class="org-row">' +
        content +
        "</tr></table></td>";

      if (ilength < target) {
        jQuery(this)
          .closest("tr.org-row")
          .children("td.node-container")
          .eq(ilength - 1)
          .after(temp_node);
      } else {
        jQuery(this)
          .closest("tr.org-row")
          .children("td.node-container")
          .eq(target - 1)
          .after(temp_node);
      }
    });
    jQuery(".jOrgChart tr.node-cells td .downarrow").each(function() {
      if (
        jQuery(this)
          .closest("tr.node-cells")
          .next("tr").length < 1
      ) {
        jQuery(this).hide();
      }
    });
  });
}
